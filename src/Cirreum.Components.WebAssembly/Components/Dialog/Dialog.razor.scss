// Dialog variables
$dialog-min-width: 320px !default;
$dialog-max-width: unset !default;
$dialog-body-padding: 1rem !default;
$dialog-body-color: null !default;
$dialog-border-width: var(--bs-border-width) !default;
$dialog-border-color: var(--bs-border-color-translucent) !default;
$dialog-border-radius: var(--bs-border-radius) !default;
$dialog-inner-border-radius: calc(var(--bs-border-radius) - var(--bs-border-width)) !default;
$dialog-scrollable-margin: 4rem !default;
$dialog-title-line-height: 1.5rem !default;
$dialog-z-index: 1031 !default;
$dialog-overlay-z-index: 13 !default;
$dialog-content-z-index: 14 !default;
$dialog-buttons-bg-color: null !default;
$dialog-buttons-gap: 0.5rem !default;
$dialog-cap-padding-y: 0.5rem !default;
$dialog-cap-padding-x: 0.5rem !default;
$dialog-cap-bg: rgba(var(--bs-body-color-rgb), 0.03) !default;
$dialog-cap-color: null !default;

// Breakpoints
$breakpoints: ( mobile: 426px, sm: 576px, md: 768px, lg: 992px, xl: 1200px, xxl: 1400px );

@mixin breakpoint-min($name) {
	@media (min-width: map-get($breakpoints, $name)) {
		@content;
	}
}

@mixin breakpoint-max($name) {
	@media (max-width: map-get($breakpoints, $name)) {
		@content;
	}
}

// Dialog sizes
$dialog-sizes: ( mobile: 95vw, sm: 480px, md: 640px, lg: 800px, xl: 1140px, xxl: 1140px, max: 75vw );

@function dialog-size($size) {
	@return map-get($dialog-sizes, $size);
}

@mixin flex-center {
	display: flex;
	justify-content: center;
	align-items: center;
}

$dialog-box-shadows: ( light: (rgba(0, 0, 0, 0.28) 0px 16px 18px 0px, rgba(0, 0, 0, 0.12) 0px 4px 16px 0px), dark: (rgba(0, 0, 0, 0.25) 0px 16px 18px 0px, rgba(0, 0, 0, 0.15) 0px 4px 16px 0px) );

@mixin dialog-box-shadow($theme: 'light') {
	box-shadow: map-get($dialog-box-shadows, $theme);
}

@mixin dialog-position($props) {
	position: absolute;

	@each $prop, $value in $props {
		#{$prop}: $value;
	}
}

// Dialog styles
.dialog-container {
	--dialog-min-width: #{$dialog-min-width};
	--dialog-max-width: #{$dialog-max-width};
	@include flex-center;
	user-select: none;
	position: fixed;
	inset: 0;
	z-index: $dialog-z-index;

	&.static {
		position: relative;
		z-index: 1;
		--dialog-min-width: unset;
		--dialog-max-width: unset;
	}
	// Media Queries
	@include breakpoint-min(sm) {
		&.dialog-sm,
		&.dialog-md,
		&.dialog-lg,
		&.dialog-xl {
			--dialog-max-width: #{map-get($dialog-sizes, sm)};
		}
	}

	@include breakpoint-min(md) {
		&.dialog-md,
		&.dialog-lg,
		&.dialog-xl {
			--dialog-max-width: #{map-get($dialog-sizes, md)};
		}
	}

	@include breakpoint-min(lg) {
		&.dialog-lg,
		&.dialog-xl {
			--dialog-max-width: #{map-get($dialog-sizes, lg)};
		}
	}

	@include breakpoint-min(xl) {
		&.dialog-xl {
			--dialog-max-width: #{map-get($dialog-sizes, xl)};
		}
	}

	@include breakpoint-max(sm) {
		--dialog-max-width: #{map-get($dialog-sizes, mobile)};
	}

	@include breakpoint-max(mobile) {
		--dialog-min-width: #{map-get($dialog-sizes, mobile)};
	}
}

// Dialog overlay
.dialog-overlay {
	user-select: none;
	display: block;
	position: fixed;
	inset: 0;
	background-color: rgba(190, 190, 190, 0.25);
	z-index: $dialog-overlay-z-index;

	[data-bs-theme="dark"] & {
		background-color: rgba(30, 30, 30, 0.25);
	}

	&-nested {
		background-color: rgba(190, 190, 190, 0.05);

		[data-bs-theme="dark"] & {
			background-color: rgba(30, 30, 30, 0.075);
		}
	}
}

// Main dialog component
.dialog {
	--dialog-scrollable-margin-top: #{$dialog-scrollable-margin};
	--dialog-scrollable-margin-bottom: #{$dialog-scrollable-margin};
	--dialog-body-color: #{$dialog-body-color};
	--dialog-body-padding: #{$dialog-body-padding};
	--dialog-border-width: #{$dialog-border-width};
	--dialog-border-color: #{$dialog-border-color};
	--dialog-border-radius: #{$dialog-border-radius};
	--dialog-inner-border-radius: #{$dialog-inner-border-radius};
	--dialog-cap-padding-y: #{$dialog-cap-padding-y};
	--dialog-cap-padding-x: #{$dialog-cap-padding-x};
	--dialog-cap-bg: #{$dialog-cap-bg};
	--dialog-cap-color: #{$dialog-cap-color};
	--dialog-buttons-bg-color: #{$dialog-buttons-bg-color};
	--dialog-buttons-gap: #{$dialog-buttons-gap};
	--bs-border-color: var(--dialog-border-color);
	min-width: var(--dialog-min-width);
	max-width: var(--dialog-max-width);
	display: flex;
	flex-direction: column;
	border-radius: var(--dialog-border-radius);
	background-color: var(--bs-body-bg);
	padding: 0;
	margin: auto;
	outline: 0;
	z-index: $dialog-content-z-index;

	@include dialog-box-shadow('light');

	[data-bs-theme="dark"] & {
		@include dialog-box-shadow('dark');
	}

	.dialog-header {
		display: flex;
		align-items: center;
		padding: var(--dialog-cap-padding-y) var(--dialog-cap-padding-x);
		color: var(--dialog-cap-color);
		background-color: var(--dialog-cap-bg);

		&:first-child {
			border-radius: var(--dialog-inner-border-radius) var(--dialog-inner-border-radius) 0 0;
		}

		&.transparent {
			color: unset;
			background-color: unset;
			border-bottom: unset;
			padding-block: calc(var(--dialog-cap-padding-y) * 2);
		}

		.btn-close {
			margin-left: auto;
		}
	}

	.dialog-content-only {
		display: contents;
		user-select: none;
	}
}

::deep {
	// Deep selectors for user's implementation

	.dialog-title {
		display: flex;
		gap: 0.5rem;
		margin-bottom: 0;
		line-height: $dialog-title-line-height;
		cursor: default;
		user-select: none;
	}

	.dialog-body {
		flex: 1 1 auto;
		padding: var(--dialog-body-padding) var(--dialog-body-padding);
		color: var(--dialog-body-color);
	}

	.dialog-buttons {
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		justify-content: flex-end;
		gap: var(--dialog-buttons-gap);
		padding: calc(var(--dialog-body-padding) - var(--dialog-buttons-gap) * .5);
		background-color: var(--dialog-buttons-bg-color);
	}

	.dialog-footer {
		padding: var(--dialog-cap-padding-y) var(--dialog-cap-padding-x);
		color: var(--dialog-cap-color);
		background-color: var(--dialog-cap-bg);
		border-top: var(--dialog-border-width) solid var(--dialog-border-color);

		&.transparent {
			color: unset;
			background-color: unset;
			border-bottom: unset;
			padding-block: calc(var(--dialog-cap-padding-y) * 2);
		}

		&:last-child {
			border-radius: 0 0 var(--dialog-inner-border-radius) var(--dialog-inner-border-radius);
		}
	}

	.dialog-scrollable {
		max-height: calc(100vh - (var(--dialog-scrollable-margin-top) + var(--dialog-scrollable-margin-bottom)));
		display: flex;
		flex-direction: column;

		.dialog-content,
		.dialog-content-only {
			flex: 1 1 auto;
			display: flex;
			flex-direction: column;
			min-height: 0; // This is crucial for nested flexbox scrolling

			.dialog-body {
				flex: 1 1 auto;
				overflow-y: auto;
				min-height: 0; // Also crucial for nested flexbox scrolling
			}
		}

		.dialog-content,
		.dialog-content-only {
			flex: 1 1 auto;
			display: flex;
			flex-direction: column;
			min-height: 0; // This is crucial for nested flexbox scrolling

			> * { // for any children directly under dialog-content
				display: flex;
				flex-direction: column;
				flex: 1 1 auto;
				min-height: 0; // Also crucial for nested flexbox scrolling
			}

			.dialog-body {
				overflow-y: auto; // allow body to scroll
			}
		}

		.dialog-header,
		.dialog-buttons,
		.dialog-footer {
			flex-shrink: 0;
		}
	}
}

// Dialog positioning classes
$dialog-positions: ( center: (top: null, bottom: null, left: null, right: null, transform: none), center-left: (top: 50%, left: 1.5rem, transform: translateY(-50%)), center-right: (top: 50%, right: 1.5rem, transform: translateY(-50%)), top: (top: 3rem, left: 50%, transform: translateX(-50%)), topleft: (top: 3rem, left: 1.5rem), topright: (top: 3rem, right: 1.5rem), bottom: (bottom: 1.5rem, left: 50%, transform: translateX(-50%)), bottomleft: (bottom: 1.5rem, left: 1.5rem), bottomright: (bottom: 1.5rem, right: 1.5rem) );

@each $position, $props in $dialog-positions {
	.dialog-#{$position} .dialog {
		@include dialog-position($props);
	}
}
